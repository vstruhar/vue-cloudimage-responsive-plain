/*
 * vue-cloudimage-responsive-plain v2.0.0
 *
 * @license
 * Copyright 2022, Scaleflex
 * Released under the MIT License
 */
import{isServer as e,processReactNode as i,processParams as t,CONSTANTS as o}from"cloudimage-responsive-utils";import{resolveComponent as a,openBlock as s,createElementBlock as d,createBlock as r,withCtx as n,createElementVNode as l,mergeProps as g,normalizeClass as h,renderSlot as c,normalizeStyle as m}from"vue";import{debounce as p}from"throttle-debounce";var u={inject:["cloudProvider"],props:{src:String,width:String,height:String,params:String,sizes:Object,ratio:Number,lazyLoading:Boolean,lazyLoadConfig:Object,alt:String,className:String,onImgLoad:Function,doNotReplaceURL:Boolean},data(){return{server:e(),lazyLoadActive:!0,cloudimgURL:"",processed:!1,loaded:!1,loadedImageWidth:"",loadedImageHeight:"",loadedImageRatio:"",data:"",properties:{src:this.src,width:this.width,height:this.height,params:this.params,sizes:this.sizes,ratio:this.ratio,lazyLoading:this.lazyLoading,lazyLoadConfig:this.lazyLoadConfig,alt:this.alt,className:this.className,config:this.cloudProvider.config,onImgLoad:this.onImgLoad,doNotReplaceURL:this.doNotReplaceURL},preserveSize:"",imgNodeWidth:"",imgNodeHeight:"",otherProps:"",cloudimgSRCSET:"",loadedStyle:""}},mounted(){if(this.server)return;const{config:{delay:e}}=this.properties;this.loadedStyle=`${this.properties.className} cloudimage-background loading`.trim(),void 0!==e?setTimeout((()=>{this.processImg()}),e):this.processImg()},updated(){if(this.data.cloudimgSRCSET){const e=this.data.cloudimgSRCSET.map((({dpr:e,url:i})=>`${i} ${e}x`)).join(", ");this.cloudimgSRCSET=e}},methods:{handler(e){setTimeout((()=>{this.lazyLoadActive=!1}),100)},processImg(e,t){const o=this.$el,a=i(this.properties,o,e,t);a&&(this.data=a)},onPreviewLoaded(e){this.previewLoaded||(this.updateLoadedImageSize(e.target),this.previewLoaded=!0)},updateLoadedImageSize(e){this.loadedImageWidth=e.naturalWidth,this.loadedImageHeight=e.naturalHeight,this.loadedImageRatio=e.naturalWidth/e.naturalHeight},_onImgLoad(e){this.updateLoadedImageSize(e.target),this.loaded=!0;const{onImgLoad:i}=this.properties;"function"==typeof i&&i(e)},getWidth:e=>e?parseInt(e,10):null,getHeight:e=>e?parseInt(e,10):null},watch:{"properties.config.innerWidth":function(e,i){if(this.server)return;const{config:{innerWidth:t}}=this.properties;i!==t&&this.processImg(!0,t>i)},"properties.src":function(e,i){const{src:t}=this.properties;t!==i.src&&this.processImg()},loaded:function(e){const i=e;this.loadedStyle=`${this.properties.className} cloudimage-background ${i?"loaded":"loading"}`.trim()}}};const f=["alt"],L=["alt","width","height"],y=["src","srcset","alt","width","height"];u.render=function(e,i,t,o,c,m){const p=a("lazy-component");return c.server?(s(),d("img",{key:0,alt:c.properties.alt},null,8,f)):!c.server&&c.properties.config.lazyLoading&&c.lazyLoadActive?(s(),r(p,{key:1,onShow:m.handler},{default:n((()=>[l("img",g({...c.otherProps},{class:c.loadedStyle,alt:c.properties.alt,onLoad:i[0]||(i[0]=(...e)=>m._onImgLoad&&m._onImgLoad(...e)),width:m.getWidth(t.width),height:m.getHeight(t.height)}),null,16,L)])),_:1},8,["onShow"])):(s(),d("img",{key:2,class:h(c.loadedStyle),src:c.data.cloudimgURL,srcset:c.cloudimgSRCSET,alt:c.properties.alt,width:m.getWidth(t.width),height:m.getHeight(t.height),onLoad:i[1]||(i[1]=(...e)=>m._onImgLoad&&m._onImgLoad(...e))},null,42,y))},u.__file="src/Img.vue";var I={inject:["cloudProvider"],props:{src:String,params:String,styles:Object,width:String,height:String,sizes:Object,ratio:Number,lazyLoading:Boolean,lazyLoadConfig:Object,alt:String,className:String,onImgLoad:Function,doNotReplaceURL:Boolean},data(){return{server:e(),lazyLoadActive:!0,cloudimgURL:"",processed:!1,loaded:!1,data:"",properties:{src:this.src,params:this.params?this.params:void 0,config:this.cloudProvider.config,style:this.styles,width:this.width,height:this.height,sizes:this.sizes,ratio:this.ratio,lazyLoading:this.lazyLoading,lazyLoadConfig:this.lazyLoadConfig,alt:this.alt,className:this.className,onImgLoad:this.onImgLoad,doNotReplaceURL:this.doNotReplaceURL},combinedStyle:"",container:"",loadedStyle:""}},mounted(){this.server||(this.loadedStyle=this.loadedStyle=`${this.properties.className} cloudimage-background loading`.trim(),this.combinedStyle={...this.properties.style,backgroundImage:`url(${this.data.cloudimgURL})`},this.processBg())},methods:{handler(e){this.lazyLoadActive=!1,this.combinedStyle={...this.properties.style,backgroundImage:`url(${this.data.cloudimgURL})`}},processBg(e,t){const o=this.$el,a=i(this.properties,o,e,t);a&&(this.data=a)},preLoadImg(e){const i=new Image;this.properties,i.onload=function(){},i.src=e},_onImgLoad(e){this.loaded=!0;const{onImgLoad:i}=this.properties;"function"==typeof i&&i(e)}},watch:{"properties.config.innerWidth":function(e,i){if(this.properties.style,this.data.cloudimgURL,this.data.previewCloudimgURL,this.loaded,this.server)return;const{config:{innerWidth:t}}=this.properties;i!==t&&this.processBg(!0,t>i),this.combinedStyle={...this.properties.style,backgroundImage:`url(${this.data.cloudimgURL})`}},"properties.src":function(e,i){const{src:t}=this.properties;t!==i.src&&this.processBg()},loaded:function(e){const i=e;i&&(this.loaded,this.combinedStyle={...this.properties.style,backgroundImage:`url(${this.data.cloudimgURL})`}),this.loadedStyle=`${this.properties.className} cloudimage-background ${i?"loaded":"loading"}`.trim()},lazyLoadActive:function(){if(!this.lazyLoadActive){const{config:{delay:e}}=this.cloudProvider;void 0!==e?setTimeout((()=>{this.preLoadImg(this.data.cloudimgURL)}),e):this.preLoadImg(this.data.cloudimgURL)}}}};const S={key:0};I.render=function(e,i,t,o,g,p){const u=a("lazy-component");return g.processed?(s(),d("div",S,[c(e.$slots,"default")])):g.properties.config.lazyLoading&&g.lazyLoadActive?(s(),r(u,{key:1,onShow:p.handler},{default:n((()=>[l("div",{class:h(g.loadedStyle),style:m(g.combinedStyle)},[c(e.$slots,"default")],6)])),_:3},8,["onShow"])):(s(),d("div",{key:2,class:h(g.loadedStyle),style:m(g.combinedStyle)},[c(e.$slots,"default")],6))},I.__file="src/Background.vue";var v={props:{cloudImageConfig:Object},data(){return{config:{token:this.cloudImageConfig.token||"",domain:this.cloudImageConfig.customDomain||"cloudimg.io",customDomain:this.cloudImageConfig.customDomain||!1,lazyLoading:this.cloudImageConfig.lazyLoading||!0,lazyLoadOffset:this.cloudImageConfig.lazyLoadOffset||100,placeholderBackground:this.cloudImageConfig.placeholderBackground||"#f4f4f4",baseURL:this.cloudImageConfig.baseUrl||this.cloudImageConfig.baseURL,delay:this.cloudImageConfig.delay||0,exactSize:!1,presets:this.cloudImageConfig.presets?this.cloudImageConfig.presets:{xs:"(max-width: 575px)",sm:"(min-width: 576px)",md:"(min-width: 768px)",lg:"(min-width: 992px)",xl:"(min-width: 1200px)"},params:this.cloudImageConfig.params?t(this.cloudImageConfig.params):"org_if_sml=1",apiVersion:"v7",imageSizeAttributes:this.cloudImageConfig.imageSizeAttributes||"use",innerWidth:"undefined"!=typeof window?window.innerWidth:null,previewQualityFactor:10,doNotReplaceURL:this.cloudImageConfig.doNotReplaceURL||!1,devicePixelRatioList:this.cloudImageConfig.devicePixelRatioList||o.DEVICE_PIXEL_RATIO_LIST,limitFactor:this.cloudImageConfig.limitFactor||100,ignoreNodeImgSize:this.cloudImageConfig.ignoreNodeImgSize,xs:"(max-width: 575px)",sm:"(min-width: 576px)",md:"(min-width: 768px)",lg:"(min-width: 992px)",xl:"(min-width: 1200px)"}}},created(){"undefined"!=typeof window&&window.addEventListener("resize",p(100,(()=>{this.config.innerWidth=window.innerWidth})))},beforeUnmount(){window.removeEventListener("resize",p(100,(()=>{this.config.innerWidth=window.innerWidth})))},provide(){const e={};return Object.defineProperty(e,"config",{enumerable:!0,get:()=>this.config}),{cloudProvider:e}}};v.render=function(e,i,t,o,a,r){return s(),d("div",null,[c(e.$slots,"default")])},v.__file="src/CloudImageProvider.vue";export{I as BackgroundImg,v as CloudImageProvider,u as Img,u as default};
